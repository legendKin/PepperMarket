<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="script">
	<!-- Bootstrap core JS-->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
	></script>
	<script>
		$(document).ready(function () {
			const userId = /*[[${#authentication.principal.id}]]*/ "anonymous"; // 로그인한 사용자의 ID
			const chatRoomId = /*[[${chatRoomId}]]*/ "defaultRoom"; // 채팅방 ID
			const receiverId = /*[[${receiverId}]]*/ "defaultReceiver"; // 수신자 ID


			// 채팅 목록 불러오기 함수
			function loadChatRooms() {
				$.ajax({
					type: 'GET',
					url: `/chat/chats?userId=${userId}`,
					success: function (chatRooms) {
						const chatList = $('#chatList');
						chatList.empty();
						chatRooms.forEach(chatRoom => {
							chatList.append(`<li> ${chatRoom.partnerName}님의 메세지 - <a href="/chat/room/${chatRoom.chatRoomId}?receiverId=${userId}">채팅방으로 이동</a></li>`);
						});
					},
					error: function (error) {
						console.error('채팅 방 목록 로딩 중 오류 발생:', error);
					}
				});
			}

			// 페이지 로드 시 데이터 불러오기
			loadChatRooms();
		});
	</script>
</th:block>
</html>
